function updateTimeChart() {
  const ctx = document.getElementById("sleepChart");
  if (sleepChart) sleepChart.destroy();

  const labels = records.map(r => r.date);
  const sleepTimes = records.map(r => parseTime(r.sleepTime));
  const wakeTimes = records.map(r => parseTime(r.wakeTime));

  sleepChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: '就寝時間',
          data: sleepTimes,
          borderColor: 'blue',
          backgroundColor: 'rgba(0,0,255,0.2)',
          tension: 0.2
        },
        {
          label: '起床時間',
          data: wakeTimes,
          borderColor: 'orange',
          backgroundColor: 'rgba(255,165,0,0.2)',
          tension: 0.2
        }
      ]
    },
    options: {
      scales: {
        y: {
          min: 0,
          max: 24,
          title: { display: true, text: '時間（時）' },
          ticks: {
            callback: val => `${Math.floor(val)}:${('0'+Math.round((val%1)*60)).slice(-2)}`
          }
        }
      }
    }
  });
}

function parseTime(timeStr) {
  const [h,m] = timeStr.split(':').map(Number);
  return h + m/60;
}
