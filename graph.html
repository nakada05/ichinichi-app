<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>睡眠グラフ</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{font-family:"Hiragino Kaku Gothic ProN",sans-serif;background:#fff8e7;padding:18px}
    h1{background:orange;color:#fff;padding:12px;border-radius:12px;text-align:center}
    .top-link{display:block;margin-top:12px;text-decoration:none;color:#444}
    .warning{color:#666;text-align:center;margin-top:20px}
  </style>
</head>
<body>
  <h1>睡眠グラフ</h1>
  <a class="top-link" href="index.html">← ホーム</a>

  <canvas id="sleepGraph" style="margin-top:20px;"></canvas>
  <p id="msg" class="warning"></p>

  <script>
    function loadRecords() {
      return JSON.parse(localStorage.getItem('sleepData') || '[]');
    }

    function createGraph() {
      const data = loadRecords();

      // ----- データなし対策 -----
      if (!data.length) {
        document.getElementById('msg').textContent = "まだデータがありません。記録するとグラフが表示されます。";
        return;
      }

      // ----- Safariエラー対策：日付・数値は必ず安全に -----
      const labels = data.map(r => r.date || "不明");
      const hours = data.map(r =>
        r.duration && !isNaN(r.duration)
          ? Number(r.duration)
          : 0
      );

      const ctx = document.getElementById('sleepGraph').getContext('2d');

      new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [{
            label: "睡眠時間（時間）",
            data: hours,
            borderWidth: 2,
            fill: false,
            tension: 0.3
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: "睡眠時間（h）" }
            }
          }
        }
      });
    }

    createGraph();
  </script>
</body>
</html>
